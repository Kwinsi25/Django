{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Dashboard</title>

  <!-- Google Font: Source Sans Pro -->
  <!-- custom -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
<link rel="stylesheet" href="{% static '/css/all.min.css' %}">
<!-- Ionicons -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<!-- Tempusdominus Bootstrap 4 -->
<link rel="stylesheet" href="{% static '/css/tempusdominus-bootstrap-4.min.css' %}">
<!-- iCheck -->
<link rel="stylesheet" href="{% static '/css/icheck-bootstrap.min.css' %}">
<!-- JQVMap -->
<link rel="stylesheet" href="{% static '/css/jqvmap.min.css' %}">
<!-- Theme style -->
<link rel="stylesheet" href="{% static '/css/adminlte.min.css' %}">
<!-- overlayScrollbars -->
<link rel="stylesheet" href="{% static '/css/OverlayScrollbars.min.css' %}">
<!-- Daterange picker -->
<link rel="stylesheet" href="{% static '/css/daterangepicker.css' %}">
<!-- summernote -->
<link rel="stylesheet" href="{% static '/css/summernote-bs4.min.css' %}">
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
<!-- Table -->
<link rel="stylesheet" href="{% static '/css/dataTables.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static '/css/responsive.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static '/css/buttons.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static '/css/customs_css.css' %}">

</head>
<style>
    .error{
      color: red;
    }
	  #option input[type=text],#option input[type=number]{
    	width: 70%;
    }
</style>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    {% block header %}
    <nav  class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
          <li class="nav-item">
              <a class="nav-link" style="color: white;" data-widget="pushmenu" href="#" role="button"><i class="fa fa-bars"></i></a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'admin:index' %}" style="color: white;" class="nav-link">Home</a>
          </li>
        </ul>
    
        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
            <!-- Navbar Search -->
            <li class="nav-item">
            <a class="nav-link" style="color: white;" data-widget="navbar-search" href="#" role="button">
                <i class="fa fa-search"></i>
            </a>
            <div class="navbar-search-block">
                <form class="form-inline">
                <div class="input-group input-group-sm">
                  <input class="form-control form-control-navbar" style="color: white;" type="search" placeholder="Search" aria-label="Search">
                  <div class="input-group-append">
                    <button class="btn btn-navbar" style="color: white;" type="submit">
                      <i class="fa fa-search"></i>
                    </button>
                    <button class="btn btn-navbar" style="color: white;" type="button" data-widget="navbar-search">
                      <i class="fa fa-times"></i>
                    </button>
                </div>
                </div>
              </form>
            </div>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" data-widget="fullscreen" style="color: white;" href="#" role="button">
              <i class="fa fa-expand"></i>
            </a>
          </li>
          <!-- user start -->
          <li class="nav-item dropdown">
              <a class="nav-link" data-toggle="dropdown" href="#" style="color: white;">
              <p>Welcome, {% firstof user.get_short_name user.get_username %}</p>
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                
              <div class="dropdown-divider"></div>
              {% if user.has_usable_password %}
              <a href="{% url 'admin:password_change' %}" class="dropdown-item">
                <i class="fa fa-key"></i>Change Password
                </a>
              {% endif %}
              <div class="dropdown-divider"></div>
              <a href="{% url 'admin:logout' %}" class="dropdown-item">
                <i class="fa fa-power-off"></i> Logout
                </a>
            </div>
          </li>
          <!--/uer end  -->
        </ul>
      </nav>
    {% endblock %}
    
    {% block nav-sidebar %}
    {% include 'admin/nav_sidebar.html' %}
    {% endblock %}
    {% block content %}
    {{content}
    {% endblock %}
    {% block footer %}
    <footer class="main-footer">
        <strong>Copyright &copy; 2022 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
        All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
          <b>Version</b> 3.2.0
        </div>
      </footer>
    {% endblock %}
</div>
  <!-- attribute -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
  <!-- jQuery -->
  <script src="{% static '/js/jquery.min.js' %}"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="{% static '/js/jquery-ui.min.js' %}"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <!-- Bootstrap 4 -->
  <script src="{% static '/js/bootstrap.bundle.min.js' %}"></script>
  <!-- ChartJS -->
  <script src="{% static '/js/Chart.min.js' %}"></script>
  <!-- Sparkline -->
  <script src="{% static '/js/sparkline.js' %}"></script>
  <!-- jQuery Knob Chart -->
  <script src="{% static '/js/jquery.knob.min.js' %}"></script>
  <!-- daterangepicker -->
  <script src="{% static '/js/moment.min.js' %}"></script>
  <script src="{% static '/js/daterangepicker.js' %}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="{% static '/js/tempusdominus-bootstrap-4.min.js' %}"></script>
  <!-- Summernote -->
  <script src="{% static '/js/summernote-bs4.min.js' %}"></script>
  <!-- overlayScrollbars -->
  <script src="{% static '/js/jquery.overlayScrollbars.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static '/js/adminlte.js' %}"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="{% static '/js/demo.js' %}"></script>
  <!-- DataTables  & Plugins -->
  <script src="{% static '/js/jquery.dataTables.min.js' %}"></script>
  <script src="{% static '/js/dataTables.bootstrap4.min.js' %}"></script>
  <script src="{% static '/js/dataTables.responsive.min.js' %}"></script>
  <script src="{% static '/js/responsive.bootstrap4.min.js' %}"></script>
  <script src="{% static '/js/dataTables.buttons.min.js' %}"></script>
  <script src="{% static '/js/buttons.bootstrap4.min.js' %}"></script>
  <script src="{% static '/js/jszip.min.js' %}"></script>
  <script src="{% static '/js/pdfmake.min.js' %}"></script>
  <script src="{% static 'js/vfs_fonts.js' %}"></script>
  <script src="{% static '/js/buttons.html5.min.js' %}"></script>
  <script src="{% static '/js/buttons.print.min.js' %}"></script>
  <script src="{% static '/js/buttons.colVis.min.js' %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"> </script>  
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

  <script src="{% static '/js/custom.js'%}"></script>
  <script>
      tinymce.init({
        selector: '#blockContent',
        plugins: 'image code',
        toolbar: 'undo redo | link image | code',
        image_title: true,
        automatic_uploads: true,
        file_picker_types: 'image',
        file_picker_callback: function (cb, value, meta) {
          var input = document.createElement('input');
          input.setAttribute('type', 'file');
          input.setAttribute('accept', 'image/*');
          input.onchange = function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.onload = function () {
              var id = 'blobid' + (new Date()).getTime();
              var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
              var base64 = reader.result.split(',')[1];
              var blobInfo = blobCache.create(id, file, base64);
              blobCache.add(blobInfo);
              cb(blobInfo.blobUri(), { title: file.name });
            };
            reader.readAsDataURL(file);
          };

          input.click();
        },
        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
      });
    $(function () {
      $(".tabs").tabs();
      // password validation
      $("#password").on('keyup', function(){
        var number = /([0-9])/;
        var alphabets = /([a-zA-Z])/;
        var special_characters = /([~,!,@,#,$,%,^,&,*,-,_,+,=,?,>,<])/;
        if ($('#password').val().length < 6) {
          $('#password-strength-status').removeClass();
          $('#password-strength-status').addClass('weak-password');
          $('#password-strength-status').html("Weak (should be atleast 6 characters.)");
        } else {
          if ($('#password').val().match(number) && $('#password').val().match(alphabets) && $('#password').val().match(special_characters)) {
              $('#password-strength-status').removeClass();
              $('#password-strength-status').addClass('strong-password');
              $('#password-strength-status').html("Strong");
          } else {
              $('#password-strength-status').removeClass();
              $('#password-strength-status').addClass('medium-password');
              $('#password-strength-status').html("Medium (should include alphabets, numbers and special characters or some combination.)");
          }
        }
     });
    // banner form validation
    $('#bannerForm').validate({
      rules:{
        bannergroup:{
          required:{
            depends: function(element) {
              return $("#bannergroup").val() == "";
            }
          }
        },
        status:{
          required:{
            depends: function(element) {
              return $("#status").val() == "";
            }
          }
        },
        order:{
          required:true
        },
        title:{required:true},
        content:{required:true},
        image_url:{
          url:true
        },
        image:{
          required:true
        },
        title:{
          required:true
        },
        content:{
          required:true
        }
      },
      messages:{
        bannergroup:{required:"Please Select at least one Group"},
        status:{required:"Please Select status"},
        order:{required:"Please enter order"},
        title:{required:"Please enter title"},
        content:{required:"Please enter content"},
        image_url:{
          url:"Enter valid url"
        },
        image:{
          required:"Please select image"
        },
        title:{
          required:"Please enter title"
        },
        content:{
          required:"Please enter content"
        }
      },
            
    });
    $('#customerForm').validate({
      rules:{
        firstName:"required",
        lastName:"required",
        contactNo:"required",
        email:"required",
        image:"required",
        password:{
          required:{
            depends:function(){
              $(this).val($.trim($(this).val()));
              return true;
            }
          }
        },
        confirmPassword:"required",
        group:{
          required:{
            depends: function(element) {
              return $("#group").val() == "";
            }
          }
        },
        name:{
          required:true,
        },
        houseNo:"required",
        streetAddress:"required",
        postalCode:"required"
        },
      messages:{
          firstName:"Please Enter First Name",
          lastName:"Please Enter Last Name",
          contactNo:"Please Enter Contact Number",
          email:"Please Enter Email",
          image:"Please Select Image For Profile",
          password:{
            required:"Please Enter Password",
          },
          ConfirmPassword:"Please Enter Password",
          group:{
            required:"Please Select Customer Group"
          },
          name:{
            required:"Please Enter Address Type"
          },
          houseNo:"Please Enter House No",
          streetAddress:"Please Enter Street Detail",
          postalCode:"Please Enter Pin code"
      },
      errorElement: 'span',
      errorPlacement: function (error, element) {
        error.addClass('invalid-feedback');
        element.closest('.form-group').append(error);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass('is-invalid');
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass('is-invalid');
      }
  
    });
    // address
    $("#addData").click(function () {
      var count = $('[id^=oprioncount]').length - 1;
      count++;      
      if (count < 5) {
        var html = `<div id="oprioncount[${count}]">
          <div class="row">
            <div class="col-sm-6">                                                          
              <div class="form-group">
                <label for="name">Address Type(Home/Office):</label>
                <input type="text" class="form-control" id="option['${count}'][name]" name="option['${count}'][name]" >
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label for="houseNo">House No./ Building / Appartment:</label>
                <input type="text" class="form-control" id="option['${count}'][houseNo]" name="option['${count}'][houseNo]" >
              </div>
            </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="form-group">
                  <label for="streetAddress">Area / Street / Sector / Village:</label>
                  <input type="text" class="form-control" id="option['${count}'][streetAddress]" name="option['${count}'][streetAddress]" >
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="landmark">Landmark:</label>
                  <input type="text" class="form-control" id="option['${count}'][landmark]" name="option['${count}'][landmark]" >
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="postalCode">Pincode:</label>
                  <input type="number" class="form-control" id="option['${count}'][postalCode]" name="option['${count}'][postalCode]" >
                </div>
              </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label for="isDefault">Default:</label>
                    <input type="radio" class="radioUpdate" id="option['${count}'][isDefault]" name="option['${count}'][isDefault]" >
                  </div>
                </div>
                <div class="col-sm-6">
                  <input type="button" class="deleteAddress"  value="Delete" style="background-color: #dc3545;border:none;color:white;border-radius:5%;float: right;">
                </div>
                </div>
              </div>`;
              $("#optiontable").append(html);
            }
            $(".deleteAddress").click(function () {
                $(event.target).closest("div").remove();
            });
            $(".radioUpdate").change(function() {
              $(".radioUpdate").not(this).prop('checked', false);
            });
        });
          $('.btn-outline-success').click(function(){
            let id = $(this).attr("id")
            console.log(id)
            let csr = $("input[name=csrfmiddlewaretoken").val()
            console.log(csr)
            mydata = {id:id,csrfmiddlewaretoken : csr}
            console.log(mydata)
            $.ajax({
              url: "/edit?id=" + id + "/",
              method:'GET',
              data: mydata,
              success:function(data){
                console.log(data)
                $("#addressId").val(data.addressId)
                $("#name").val(data.name)
                $("#houseNo").val(data.houseNo)
                $("#streetAddress").val(data.streetAddress)
                $("#landmark").val(data.landmark)
                $("#postalCode").val(data.postalCode)
                $("#isDefault").prop("checked",data.isDefault)
                
              }
            })
           
          })
          $(".btn-outline-danger").click(function(e){
            e.preventDefault();

            var id = $(this).parent("div").attr("id");
            console.log(id);
            if (confirm('Are you sure you want to Delete?')) {
            $.ajax({
                url: "/delete?id=" + id + "/",
                type: 'GET',
                success: function (response) {
                $("#" + id).remove();
                alert("Delete successfully.");
                location.reload();
                },
                error: function () {
                alert('Something is wrong, couldn\'t delete record');
                },

                cache: false,
                contentType: false,
                processData: false,

            });
            }
          })
  //         $("#tabs-1").tabs();  
  //         $("#BlockTranslation").tabs();
  //         $("#block").tabs();
  //         $('#oprion').show();
  //       // tabs
        $(".tabs").tabs();
        // radio button
        $(".radio").change(function() {
          $(".radio").not(this).prop('checked', false);
        });
        // adding new rows
        var count=$('[id^=option-row]').length - 1;
        $("#add").click(function () {
          count++;
          if (count<10){
              var html = `<tr id="option-row[${count}]">
                {% for i in language %}
                  <td>
                    <input type="text" class="form-control" id="option{{i.locale}}['${count}'][opname]" name="option{{i.locale}}['${count}'][opname]" required>
                    <input type="hidden" class="form-control" id="option{{i.locale}}['${count}'][oplanguage]" name="option{{i.locale}}['${count}'][oplanguage]" value="{{i.locale}}">
                  </td>
                {% endfor %}
                <td><input type="text" class="form-control" id="option['${count}'][customoption]" name="option['${count}'][customoption]" required></td>
                
                <td><input type="number"  class="form-control"id"option['${count}'][order]" name="option['${count}'][order]" required></td>
                
                <td><input type="radio" class="radio" id="option['${count}'][default]" name="option['${count}'][default]" ></td>
                <td><input type="button" class="delete"  value="Delete" style="background-color: #dc3545;border:none;color:white;border-radius:5%"></td>
              </tr>`;
              $("#tbl").append(html);
          }
        // delete row
        $(".delete").click(function(){
          $(event.target).closest("tr").remove();
        });
        $(".radio").change(function() {
          $(".radio").not(this).prop('checked', false);
        });  
      });

        var dltcount=0;
        $(".delete").click(function(){
          var dltId = $(this).parent().attr('id');
          if(dltId != undefined){
          var dlt = `<input type="hidden" id="deleterows['${dltcount}']" name="deletedata['${dltcount}']" value="${dltId}">`
          $("#tbl").append(dlt);
          }
          $(event.target).closest("tr").remove();
          dltcount++;      
        });
        var arr = ['radio','select','multiselect','checkbox']

        if(jQuery.inArray($("#inputtype").val(),arr) != -1){
            $("#optiondiv").show()
            $("#option-row td input").prop('required',true);
          }
          else{
            $("#optiondiv").hide()
            $("#option-row td input").prop('required',false);
          }

        $("#inputtype").change(function(){
          if(jQuery.inArray($("#inputtype").val(),arr) != -1){
            $("#optiondiv").show()
            $("#option-row td input").prop('required',true);
          }
          else{
            $("#optiondiv").hide()
            $("#option-row td input").prop('required',false);
            
          }
        });
        $("#bannergroup").change(function(){
            
            // var rowCount = $("#bannerinfo tr").length-1;
            thisSelect = $(this).val();
            thisSelectedvals = []
            $("#bannergroup option:selected").each(function()
            {
                thisSelectedvals.push($.trim(($(this).text())));
            });
            // var dltcount = 0
            $("#bannergroup option:not(:selected)").each(function()
            {
                var dltId = $(".added-"+$(this).val()+" [id^=bannerimgid]").val();
                if(dltId != undefined){
                var dlt = `<input type="hidden" id="deletedata[0]" name="deletedata[0]" value="${dltId}">`
                $("#banner").append(dlt);
                }
                // dltcount++;
                $(".added-"+$(this).val()+"").remove();
                
            });
            
            
            
            var countselected=thisSelect.length;
            console.log("selected",thisSelect);

            
            
            for(i=0;i<countselected;i++){
                console.log($(".added-"+thisSelect[i]+"").length);
               
                if($(".added-"+thisSelect[i]+"").length>0){
                }else {
                    
                var html = `<tr class="added-${thisSelect[i]}">
                <td>${thisSelectedvals[i]}</td>
                <td><div class="row"><a id="imglink" class="col-md-2" href="#"><img id="img" src ="#" style="height:50px; width:50px;"></a>
                <input type="file" class="form-control col-md-8 mt-2" id="image" name="bannerimage[${thisSelect[i]}]" onchange="readURL(this);" accept="image/*" required>
                </div></td>
                <td><input type="url" class="form-control" id="url[${thisSelect[i]}]" name="url[${thisSelect[i]}]"></td>
                <input type="hidden"  id="bannergrpid[${thisSelect[i]}]" name="bannergrpid[${thisSelect[i]}]" value="${thisSelect[i]}" required>
                </tr>`;
                
                $("#bannerinfo").append(html);
                
                }
            }
            
        })
       
  });
</script>
</body>
</html>